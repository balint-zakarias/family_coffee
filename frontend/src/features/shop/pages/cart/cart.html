<div class="cart-page">
  <!-- st√°tuszok -->
  <section *ngIf="loading()" class="status">Bet√∂lt√©s‚Ä¶</section>
  <section *ngIf="error()" class="status error">Hiba: {{ error() }}</section>

  <!-- √ºres √°llapot -->
  <section class="empty" *ngIf="!loading() && !items().length" style="height:100vh; display:flex; align-items:center; justify-content:center;">
    A kosarad √ºres.
  </section>

  <!-- sorok csak akkor, ha van t√©tel -->
  <section class="wrap head" *ngIf="!loading() && items().length">
    <h1>Rendel√©s</h1>
    <h2>Kos√°r tartalma</h2>

    <div class="lines">
      <div
        class="line"
        *ngFor="let it of items(); trackBy: trackById"
        [class.busy]="isPending(it.id)"
        [attr.aria-busy]="isPending(it.id) ? 'true' : 'false'"
      >
        <div class="prod">
          <img [src]="it.imageUrl" [alt]="it.name" />
          <div class="meta">
            <div class="title">{{ it.name }}</div>
            <div class="sub" *ngIf="it.subtitle">{{ it.subtitle }}</div>
          </div>
        </div>

        <div class="qty">
          <button
            type="button"
            class="qbtn"
            (click)="dec(it.id)"
            [disabled]="isPending(it.id)"
            [attr.aria-label]="'Mennyis√©g cs√∂kkent√©se: ' + it.name"
          >‚àí</button>

          <div class="qval">{{ it.qty }}</div>

          <button
            type="button"
            class="qbtn"
            (click)="inc(it.id)"
            [disabled]="isPending(it.id)"
            [attr.aria-label]="'Mennyis√©g n√∂vel√©se: ' + it.name"
          >+</button>
        </div>

        <div class="price">{{ (it.unitPrice * it.qty) | number:'1.0-0' }} Ft</div>

        <button
          type="button"
          class="trash"
          aria-label="T√∂rl√©s"
          (click)="remove(it.id)"
          [disabled]="isPending(it.id)"
          [attr.aria-label]="'T√©tel t√∂rl√©se: ' + it.name"
        >üóëÔ∏è</button>
      </div>
    </div>

    <div class="total">
      <div class="label">V√©g√∂sszeg:</div>
      <div class="value">{{ total() | number:'1.0-0' }} Ft</div>
    </div>
  </section>

  <!-- Adatok / ≈±rlap blokk (marad vizu√°lis) -->
  <section class="checkout" *ngIf="!loading() && items().length">
    <div class="wrap">
      <h3>Adatok</h3>
      <form class="form" [formGroup]="orderForm" (ngSubmit)="onSubmitOrder()">
        <div class="row">
          <input 
            type="text" 
            placeholder="N√©v *" 
            class="input full" 
            formControlName="customerName"
            [class.error]="orderForm.get('customerName')?.invalid && orderForm.get('customerName')?.touched"
          />
        </div>
        <div class="row">
          <input 
            type="tel" 
            placeholder="Telefon *" 
            class="input" 
            formControlName="customerPhone"
            [class.error]="orderForm.get('customerPhone')?.invalid && orderForm.get('customerPhone')?.touched"
          />
          <input 
            type="email" 
            placeholder="E-mail" 
            class="input" 
            formControlName="customerEmail"
            [class.error]="orderForm.get('customerEmail')?.invalid && orderForm.get('customerEmail')?.touched"
          />
        </div>
        <div class="row">
          <input 
            type="text" 
            placeholder="Ir√°ny√≠t√≥sz√°m *" 
            class="input" 
            formControlName="shippingZip"
            [class.error]="orderForm.get('shippingZip')?.invalid && orderForm.get('shippingZip')?.touched"
          />
          <input 
            type="text" 
            placeholder="Telep√ºl√©s *" 
            class="input" 
            formControlName="shippingCity"
            [class.error]="orderForm.get('shippingCity')?.invalid && orderForm.get('shippingCity')?.touched"
          />
        </div>
        <div class="row">
          <input 
            type="text" 
            placeholder="Utca, h√°zsz√°m *" 
            class="input" 
            formControlName="shippingAddress"
            [class.error]="orderForm.get('shippingAddress')?.invalid && orderForm.get('shippingAddress')?.touched"
          />
        </div>
        <div class="row">
          <textarea 
            placeholder="Megjegyz√©s" 
            class="textarea"
            formControlName="deliveryNotes"
          ></textarea>
        </div>

        <!-- Success message -->
        <div *ngIf="orderSuccess()" class="success-message">
          ‚úÖ Rendel√©s sikeresen leadva! Hamarosan felvessz√ºk √ñnnel a kapcsolatot.
        </div>

        <!-- Error message -->
        <div *ngIf="orderError()" class="error-message">
          ‚ö†Ô∏è {{ orderError() }}
        </div>

        <label class="policy">
          <input 
            type="checkbox" 
            formControlName="acceptedPolicy"
          />
          Elfogadom az <a href="/privacy" target="_blank">Adatv√©delmi Nyilatkozatot</a> *
        </label>
        <div class="submit-wrap">
          <button 
            type="submit" 
            class="submit"
            [disabled]="!canSubmitOrder"
          >
            <span *ngIf="orderLoading()" class="loading-spinner"></span>
            {{ orderLoading() ? 'Rendel√©s lead√°sa...' : 'Rendel√©s lead√°sa' }}
          </button>
        </div>
      </form>
    </div>
  </section>
</div>