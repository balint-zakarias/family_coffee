<app-dashboard-header></app-dashboard-header>

<main class="products-main">
  <div class="products-container">
    
    <!-- Page header -->
    <section class="page-header">
      <div class="header-content">
        <h1>Term√©kek kezel√©se</h1>
        <p>Itt kezelheti a webshop term√©keit, szerkesztheti az adatokat √©s k√∂vetheti a k√©szleteket.</p>
      </div>
      <div class="header-actions">
        <button type="button" class="btn btn-primary" (click)="navigateToCreate()">
          <span class="btn-icon">+</span>
          √öj term√©k
        </button>
      </div>
    </section>

    <!-- Filters section -->
    <section class="filters-section">
      <div class="filters-grid">
        <!-- Search -->
        <div class="filter-group">
          <label for="search" class="filter-label">Keres√©s</label>
          <div class="search-input-container">
            <input
              type="text"
              id="search"
              class="filter-input"
              placeholder="Term√©k neve, le√≠r√°s vagy cikksz√°m..."
              [value]="searchTerm()"
              (input)="onSearchChange($any($event.target).value)"
            />
            @if(searchTerm()){<button 
              class="clear-btn" 
              (click)="clearSearch()"
              type="button"
            >
              √ó
            </button>}
          </div>
        </div>

        <!-- Category filter -->
        <div class="filter-group">
          <label for="category" class="filter-label">Kateg√≥ria</label>
          <select
            id="category"
            class="filter-select"
            [value]="selectedCategoryId() || ''"
            (change)="onCategoryChange($any($event.target).value)"
          >
            <option value="">Minden kateg√≥ria</option>
            @for(category of categories(); track category.id){<option 
              [value]="category.id"
            >
              {{ category.name }}
            </option>}
          </select>
        </div>

        <!-- Show inactive -->
        <div class="filter-group">
          <label class="filter-checkbox">
            <input
              type="checkbox"
              [checked]="showInactiveProducts()"
              (change)="onShowInactiveChange($any($event.target).checked)"
            />
            <span class="checkbox-label">Inakt√≠v term√©kek megjelen√≠t√©se</span>
          </label>
        </div>
      </div>
    </section>

    <!-- Loading state -->
    @if(loading()){<section class="loading-section">
      <div class="loading-spinner"></div>
      <p>Term√©kek bet√∂lt√©se...</p>
    </section>}

    <!-- Error state -->
    @if(error()){<section class="error-section">
      <div class="error-icon">‚ö†Ô∏è</div>
      <h3>Hiba t√∂rt√©nt</h3>
      <p>{{ error() }}</p>
      <button type="button" class="btn btn-secondary" (click)="loadData()">
        √öjrapr√≥b√°l√°s
      </button>
    </section>}

    <!-- Products table -->
    @if(!loading() && !error()){<section class="products-section">
      <div class="products-header">
        <h2>Term√©kek ({{ products().length }})</h2>
      </div>

      @if(products().length > 0){<div class="products-table-container">
        <table class="products-table">
          <thead>
            <tr>
              <th>K√©p</th>
              <th>Term√©k</th>
              <th>Kateg√≥ria</th>
              <th>Cikksz√°m</th>
              <th>√År</th>
              <th>K√©szlet</th>
              <th>St√°tusz</th>
              <th>L√©trehozva</th>
              <th>M≈±veletek</th>
            </tr>
          </thead>
          <tbody>
            @for(product of products(); track trackByProductId($index, product)){<tr class="product-row">
              <!-- Product image -->
              <td class="product-image-cell">
                <img 
                  [src]="getProductImageUrl(product)" 
                  [alt]="product.name"
                  class="product-image"
                  loading="lazy"
                />
              </td>

              <!-- Product info -->
              <td class="product-info-cell">
                <div class="product-name">{{ product.name }}</div>
                @if(product.description){<div class="product-description">
                  {{ product.description.length > 100 ? (product.description | slice:0:100) + '...' : product.description }}
                </div>}
              </td>

              <!-- Category -->
              <td class="category-cell">
                @if(product.category){<span class="category-badge">
                  {{ product.category.name }}
                </span>}
                @if(!product.category){<span class="no-category">
                  Nincs kateg√≥ria
                </span>}
              </td>

              <!-- SKU -->
              <td class="sku-cell">
                <code class="sku-code">{{ product.sku }}</code>
              </td>

              <!-- Price -->
              <td class="price-cell">
                <span class="price">{{ product.price | number:'1.0-0' }} Ft</span>
              </td>

              <!-- Stock -->
              <td class="stock-cell">
                <span class="stock-badge" [class]="getStockStatusClass(product.stockQty)">
                  {{ product.stockQty }} db
                </span>
                <div class="stock-status">{{ getStockStatusText(product.stockQty) }}</div>
              </td>

              <!-- Status -->
              <td class="status-cell">
                <span class="status-badge" [class.active]="product.isActive" [class.inactive]="!product.isActive">
                  {{ product.isActive ? 'Akt√≠v' : 'Inakt√≠v' }}
                </span>
              </td>

              <!-- Created date -->
              <td class="date-cell">
                {{ product.createdAt | date:'yyyy.MM.dd' }}
              </td>

              <!-- Actions -->
              <td class="actions-cell">
                <div class="action-buttons">
                  <button type="button" class="action-btn edit" title="Szerkeszt√©s" (click)="navigateToEdit(product)">
                    ‚úèÔ∏è
                  </button>
                  <button type="button" class="action-btn view" title="Megtekint√©s" (click)="navigateToView(product)">
                    üëÅÔ∏è
                  </button>
                  <button 
                    type="button" 
                    class="action-btn delete" 
                    [title]="product.isActive ? 'Inaktiv√°l√°s' : 'T√∂rl√©s'"
                    (click)="deleteProduct(product)"
                  >
                    {{ product.isActive ? 'üö´' : 'üóëÔ∏è' }}
                  </button>
                </div>
              </td>
            </tr>}
          </tbody>
        </table>
        
        <!-- Load More Button -->
        @if(hasMore() && products().length > 0){<div class="load-more-container">
          <button 
            #loadMoreBtn
            class="load-more-btn"
            (click)="loadMore()"
            [disabled]="loading()"
          >
            @if(loading()){<span class="spinner-small"></span>}
            {{ loading() ? 'Bet√∂lt√©s...' : 'Tov√°bbi term√©kek bet√∂lt√©se' }}
          </button>
        </div>}
      </div>}

      <!-- Empty state -->
      @if(products().length === 0){<div class="empty-state">
        <div class="empty-icon">üì¶</div>
        <h3>Nincsenek term√©kek</h3>
        <p>A megadott sz≈±r≈ëknek megfelel≈ë term√©kek nem tal√°lhat√≥k.</p>
        <button type="button" class="btn btn-primary" (click)="navigateToCreate()">
          √öj term√©k hozz√°ad√°sa
        </button>
      </div>}
    </section>}

  </div>
</main>

<!-- Confirmation Modal -->
<app-confirmation-modal
  [isOpen]="showDeleteModal()"
  [title]="deleteModalTitle"
  [message]="deleteModalMessage"
  [confirmText]="deleteModalConfirmText"
  [isDangerous]="!productToDelete()?.isActive"
  (confirm)="confirmDelete()"
  (cancel)="closeDeleteModal()"
></app-confirmation-modal>
