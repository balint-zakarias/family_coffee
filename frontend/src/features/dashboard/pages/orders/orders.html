<!-- Page Header -->
<app-dashboard-header 
  title="Rendel√©sek" 
  subtitle="Be√©rkezett rendel√©sek kezel√©se √©s nyomon k√∂vet√©se"
></app-dashboard-header>

<main class="orders-main">
  <div class="orders-container">

    <!-- Filters -->
    <section class="filters-section">
      <div class="filters-grid">
        <div class="filter-group">
          <label class="filter-label">St√°tusz sz≈±r√©s</label>
          <select class="filter-select" (change)="onStatusFilterChange($event)">
            <option value="">√ñsszes rendel√©s</option>
            <option value="placed">Leadva</option>
            <option value="delivered">Kisz√°ll√≠tva</option>
            <option value="canceled">T√∂r√∂lve</option>
          </select>
        </div>
      </div>
    </section>

    <!-- Loading -->
    @if(loading()){<section class="loading-section">
      <div class="loading-spinner"></div>
      <p>Rendel√©sek bet√∂lt√©se...</p>
    </section>}

    <!-- Error -->
    @if(error()){<section class="error-section">
      <div class="error-icon">‚ö†Ô∏è</div>
      <h3>Hiba t√∂rt√©nt</h3>
      <p>{{ error() }}</p>
      <button type="button" class="btn btn-primary" (click)="loadOrders()">
        √öjrapr√≥b√°l√°s
      </button>
    </section>}

    <!-- Orders Table -->
    @if(!loading() && !error()){<section class="table-section">
      <div class="table-container">
        <table class="orders-table">
          <thead>
            <tr>
              <th>Rendel√©s #</th>
              <th>Vev≈ë</th>
              <th>El√©rhet≈ës√©g</th>
              <th>C√≠m</th>
              <th>T√©telek</th>
              <th>√ñsszeg</th>
              <th>St√°tusz</th>
              <th>D√°tum</th>
            </tr>
          </thead>
          <tbody>
            @for(order of orders(); track order.id){<tr class="order-row" (click)="openOrderDetails(order)">
              <!-- Order ID -->
              <td class="order-id">
                <strong>#{{ order.orderId }}</strong>
              </td>

              <!-- Customer -->
              <td class="customer-info">
                <div class="customer-name">{{ order.customerName }}</div>
              </td>

              <!-- Contact -->
              <td class="contact-info">
                @if(order.customerEmail){<div class="email">{{ order.customerEmail }}</div>}
                <div class="phone">{{ order.customerPhone }}</div>
              </td>

              <!-- Address -->
              <td class="address-info">
                <div class="address-section">
                  <div class="address-label">Sz√°ml√°z√°si:</div>
                  <div class="address">{{ order.billingZip }} {{ order.billingCity }}</div>
                  <div class="address">{{ order.billingAddress }}</div>
                </div>
                <div class="address-section">
                  <div class="address-label">Sz√°ll√≠t√°si:</div>
                  <div class="address">{{ order.shippingZip }} {{ order.shippingCity }}</div>
                  <div class="address">{{ order.shippingAddress }}</div>
                </div>
              </td>

              <!-- Items -->
              <td class="items-info">
                <div class="items-count">{{ getTotalItems(order) }} t√©tel</div>
                <div class="items-detail">
                  @for(item of order.items; track item){<div class="item-line">
                    {{ item.nameSnapshot }} ({{ item.quantity }}x)
                  </div>}
                </div>
              </td>

              <!-- Total -->
              <td class="total-cell">
                <strong>{{ order.grandTotal | number:'1.0-0' }} Ft</strong>
              </td>

              <!-- Status -->
              <td class="status-cell">
                <span class="status-badge" [ngClass]="getStatusClass(order.status)">
                  {{ getStatusText(order.status) }}
                </span>
              </td>

              <!-- Date -->
              <td class="date-cell">
                {{ order.createdAt | date:'yyyy.MM.dd HH:mm' }}
              </td>
            </tr>}
          </tbody>
        </table>

        <!-- Load More Button -->
        @if(hasMore() && orders().length > 0){<div class="load-more-container">
          <button 
            class="load-more-btn"
            (click)="loadMore()"
            [disabled]="loading()"
          >
            @if(loading()){<span class="spinner-small"></span>}
            {{ loading() ? 'Bet√∂lt√©s...' : 'Tov√°bbi rendel√©sek bet√∂lt√©se' }}
          </button>
        </div>}

        <!-- Empty state -->
        @if(orders().length === 0){<div class="empty-state">
          <div class="empty-icon">üì¶</div>
          <h3>Nincsenek rendel√©sek</h3>
          <p>M√©g nem √©rkezett be rendel√©s a kiv√°lasztott sz≈±r≈ëkkel.</p>
        </div>}
      </div>
    </section>}

  </div>
</main>

<!-- Order Details Modal -->
@if(showModal() && selectedOrder()){<div class="modal-overlay" (click)="closeModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Rendel√©s r√©szletei - #{{ selectedOrder()!.orderId }}</h2>
      <button class="modal-close" (click)="closeModal()">√ó</button>
    </div>
    
    <div class="modal-body">
      <!-- Customer Info -->
      <section class="info-section">
        <h3>Vev≈ë adatok</h3>
        <div class="info-grid">
          <div class="info-item">
            <label>N√©v:</label>
            <span>{{ selectedOrder()!.customerName }}</span>
          </div>
          <div class="info-item">
            <label>Email:</label>
            <span>{{ selectedOrder()!.customerEmail }}</span>
          </div>
          <div class="info-item">
            <label>Telefon:</label>
            <span>{{ selectedOrder()!.customerPhone }}</span>
          </div>
        </div>
      </section>

      <!-- Addresses -->
      <section class="info-section">
        <h3>C√≠mek</h3>
        <div class="addresses-grid">
          <div class="address-block">
            <h4>Sz√°ml√°z√°si c√≠m</h4>
            <div class="address-text">
              {{ selectedOrder()!.billingZip }} {{ selectedOrder()!.billingCity }}<br>
              {{ selectedOrder()!.billingAddress }}
            </div>
          </div>
          <div class="address-block">
            <h4>Sz√°ll√≠t√°si c√≠m</h4>
            <div class="address-text">
              {{ selectedOrder()!.shippingZip }} {{ selectedOrder()!.shippingCity }}<br>
              {{ selectedOrder()!.shippingAddress }}
            </div>
          </div>
        </div>
      </section>

      <!-- Order Items -->
      <section class="info-section">
        <h3>Rendelt t√©telek</h3>
        <div class="items-table">
          <table>
            <thead>
              <tr>
                <th>Cikksz√°m</th>
                <th>Term√©k n√©v</th>
                <th>Egys√©g√°r</th>
                <th>Mennyis√©g</th>
                <th>√ñsszesen</th>
              </tr>
            </thead>
            <tbody>
              @for(item of selectedOrder()!.items; track item.id){<tr>
                <td class="item-id">#{{ item.sku }}</td>
                <td class="item-name">{{ item.nameSnapshot }}</td>
                <td class="item-price">{{ item.unitPriceSnapshot | number:'1.0-0' }} Ft</td>
                <td class="item-quantity">{{ item.quantity }}x</td>
                <td class="item-total">{{ item.lineTotal | number:'1.0-0' }} Ft</td>
              </tr>}
            </tbody>
          </table>
        </div>
      </section>

      <!-- Order Summary -->
      <section class="info-section">
        <h3>Rendel√©s √∂sszes√≠t≈ë</h3>
        <div class="summary-grid">
          <div class="summary-item">
            <label>St√°tusz m√≥dos√≠t√°sa:</label>
            <select 
              class="status-select"
              [value]="selectedOrder()!.status.toLowerCase()"
              (change)="updateOrderStatus(selectedOrder()!.orderId, $any($event.target).value)"
              [ngClass]="getStatusClass(selectedOrder()!.status)"
            >
              <option value="placed">Leadva</option>
              <option value="delivered">Kisz√°ll√≠tva</option>
              <option value="canceled">T√∂r√∂lve</option>
            </select>
          </div>
          <div class="summary-item">
            <label>Rendel√©s d√°tuma:</label>
            <span>{{ selectedOrder()!.createdAt | date:'yyyy.MM.dd HH:mm' }}</span>
          </div>
          <div class="summary-item total">
            <label>V√©g√∂sszeg:</label>
            <span class="total-amount">{{ selectedOrder()!.grandTotal | number:'1.0-0' }} Ft</span>
          </div>
        </div>
      </section>
    </div>
  </div>
</div>}
